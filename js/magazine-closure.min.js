//***************************************************************************** 
//main
var mg=function(a){"use strict";var b={options:{directory:"magazine",json:"magazine/magazine.json",numberOfPagesToLoad:3,sliderMove:800,fullpage:!1,animationTime:300,animationType:"linear",sidebar:!0,sidebarFixed:!0,scrolling:{hScrollbar:!1,vScrollbar:!1,hScroll:!1,bounce:!0},video:!1,audio:!1,carousel:!1},maxPage:1,startLeft:-80,step:85,numberOfPagesLoaded:0,currentPage:0,currentPosition:0,animation:window.WebKitCSSMatrix?"3d":"",touchEnabled:typeof document.ontouchmove!="undefined"?!0:!1,mouse:{initiated:!1},sidebarCategoryActive:"0",sidebarHightList:[],sidebarScroller:{},slideScroller:{},videoPlayerList:[],audioPlayerList:[],deviceSize:"large",loadingSequence:{first:[{slide:4,page:2},{slide:3,page:1},{slide:2,page:0}],second:[{slide:1,page:-1},{slide:4,page:2},{slide:3,page:1},{slide:2,page:0}],third:[{slide:0,page:-2},{slide:1,page:-1},{slide:4,page:2},{slide:3,page:1},{slide:2,page:0}],middle:[{slide:0,page:-2},{slide:1,page:-1},{slide:4,page:2},{slide:3,page:1},{slide:2,page:0}],last:[{slide:0,page:-2},{slide:1,page:-1},{slide:2,page:0}],"last-but-one":[{slide:0,page:-2},{slide:1,page:-1},{slide:3,page:1},{slide:2,page:0}],"last-but-two":[{slide:0,page:-2},{slide:1,page:-1},{slide:4,page:2},{slide:3,page:1},{slide:2,page:0}]},init:function(){b.loadOptions(b.start),b.sidebar=$("#mg-sidebar"),b.slider=$("#mg-slider"),b.firstSlide=$("#mg-slide-2"),b.buttonOpen=$("#mg-sidebar-button-open"),b.buttonClose=$("#mg-sidebar-button-close"),b.bindEvents()},start:function(){var a,c;c=parseInt($("#device-size").css("font-size").replace(/px/,"")),b.deviceSize=c===3?"large":c===2?"medium":"small",b.maxPage=b.get("contents").length-1,b.get("fullpage")===!0&&($("body").attr("id","fullpage"),b.startLeft=-100,b.step=100),b.slides=[];for(a=0;a<=4;a++)b.slides.push({slideId:a,left:b.step*(a-2),page:a-2});b.loadPage($("#mg-slide-2"),0),b.loadPage($("#mg-slide-3"),1),b.loadPage($("#mg-slide-4"),2),b.options.sidebar===!0&&(b.options.sidebarFixed===!0?$("body").addClass("fixed"):(b.buttonOpen.show(),b.buttonClose.show()),b.loadSidebar())},get:function(c){return typeof b.options[c]!="undefined"?b.options[c]:a},set:function(a,c){b.options[a]=c}};return b}();window.mg=mg||{},function(a,b){a.loadSidebar=function(){a.sidebar.load(a.get("directory")+"/sidebar.html",a.loadSidebarSuccess)},a.loadSidebarSuccess=function(){a.touchEnabled===!0?(a.buttonOpen.tap(a.sidebarShow),a.buttonClose.tap(a.sidebarHide)):(a.buttonOpen.bind("click",a.sidebarShow),a.buttonClose.bind("click",a.sidebarHide)),a.sidebarEvents(),a.sidebarCalculate(),a.touchEnabled===!0?a.addEvent("sidebar-category-content-0","webkitTransitionEnd",a.sidebarListener):a.addEvent("sidebar-category-content-0","transitionend",a.sidebarListener),$(".sidebar-category-content").css("height",0),$("#sidebar-category-content-0").css("height",a.sidebarHightList[0]),$.browser.webkit===!0&&setTimeout(function(){a.sidebarScroller=new iScroll("mg-sidebar",a.options.scrolling)},0)},a.loadPrev=function(){var b=a.slides.pop(),c=a.slides[0],d=$("#mg-slide-"+b.slideId);b.left=c.left-a.step,b.page=c.page-1,d.css("left",b.left+"%"),a.slides.unshift(b),b.page>=0&&a.loadPage(d,b.page)},a.loadNext=function(){var b=a.slides.shift(),c=a.slides[a.slides.length-1],d=$("#mg-slide-"+b.slideId);b.left=c.left+a.step,b.page=c.page+1,d.css("left",b.left+"%"),a.slides.push(b),b.page<=a.maxPage&&a.loadPage(d,b.page)},a.loadPage=function(b,c){a.options.carousel===!0&&$("#"+b[0].id+" .mg-carousel").each(function(b,c){a.carouselDestroy(c)}),b.load(a.get("directory")+"/"+a.get("contents")[c],function(){a.loadSuccess(b)})},a.loadSuccess=function(b){var c;a.numberOfPagesLoaded++,a.get("numberOfPagesToLoad")===a.numberOfPagesLoaded&&a.removeLoadingIndicator(),$("#"+b[0].id+" article").each(function(b,d){$.os.ios===!0&&$.os.version>=5?a.ScrollFix(d):$.browser.webkit===!0&&setTimeout(function(){c=new iScroll(d,a.options.scrolling)},0)}),a.orientation(!1),a.options.video===!0&&$("#"+b[0].id+" .video").each(function(b,c){if($.browser.webkit===!1||$.os.android===!0&&$os.version<=2.3){a.videoPlayerList[c.id]&&a.removeVideoPlayer(a.videoPlayerList[c.id]);var d=new Date,e="video-"+d.getTime()+"-"+Math.floor(Math.random()*1e3);a.videoPlayerList[c.id]=e,c.id=e,_V_(c.id)}}),a.options.audio==1&&$("#"+b[0].id+" .audio").each(function(b,c){a.audioPlayerList[c.id]&&a.removeAudioPlayer(a.audioPlayerList[c.id]);var d=new Date,e="audio-"+d.getTime()+"-"+Math.floor(Math.random()*1e3);a.audioPlayerList[c.id]=e,c.id=e,audiojs.create(c)}),a.options.carousel===!0&&$("#"+b[0].id+" .mg-carousel").each(function(b,c){a.carouselInit(c)})},a.removeLoadingIndicator=function(){a.hideOverlay()}}(mg),function(a,b){a.prev=function(){a.currentPage>0&&(a.currentPage--,a.currentPosition+=a.getWidth(a.firstSlide)+a.getMargin(a.firstSlide),a.animate(a.slider,a.currentPosition),a.loadPrev(),a.sidebarGoTo(a.currentPage))},a.next=function(){a.currentPage<a.maxPage&&(a.currentPage++,a.currentPosition-=a.getWidth(a.firstSlide)+a.getMargin(a.firstSlide),a.animate(a.slider,a.currentPosition),a.loadNext(),a.sidebarGoTo(a.currentPage))},a.center=function(){var b;a.resetWidth(),a.resetMargin(),a.sidebarCalculate(),b=(a.getWidth(a.firstSlide)+a.getMargin(a.firstSlide))*a.slides[2].left/100*-1,a.currentPosition!==b&&(a.currentPosition=b,a.animate(a.slider,b,0,0,0)),a.options.sidebarFixed===!1&&a.sidebarHide("fast")},a.gotoPage=function(b){var c="middle",d,e;if(a.currentPage===b)return;if(a.currentPage+1===b){a.next();return}if(a.currentPage-1===b){a.prev();return}if(b>a.maxPage||b<0)return;a.showOverlay(),a.currentPage=b,a.set("numberOfPagesToLoad",3),a.numberOfPagesLoaded=0;if(b>a.maxPage-3&&b<=a.maxPage)switch(a.maxPage-b){case 0:c="last";break;case 1:c="last-but-one";break;case 2:c="last-but-two"}else if(b<3&&b>=0)switch(b){case 0:c="first";break;case 1:c="second";break;case 2:c="third"}e=a.loadingSequence[c],d=e.length-1;do a.loadPage($("#mg-slide-"+a.slides[e[d].slide].slideId),b+e[d].page),a.slides[e[d].slide].page=b+e[d].page;while(d--)},a.sidebarShow=function(){var b;a.buttonOpen.hide(),a.buttonClose.show(),b=a.getWidth(a.sidebar),a.animate(a.sidebar,b),a.animate(a.buttonClose,b),a.animate(a.buttonOpen,b)},a.sidebarHide=function(b){var c,d=0;b=b||"slow",c=a.get("animationTime"),b==="fast"&&(c="0"),a.buttonOpen.show(),a.buttonClose.hide(),a.animate(a.sidebar,d,0,0,c),a.animate(a.buttonClose,d,0,0,c),a.animate(a.buttonOpen,d,0,0,c)},a.animate=function(b,c,d,e,f,g){var c=c||0,d=d||0,e=e|0,f=f||a.get("animationTime"),g=g||a.get("animationType");a.animation==="3d"?$.os.ios?b.animate({translate3d:c+"px,"+d+"px,"+e+"px"},f,g):b.animate({translate3d:c+"px,"+d+"px,"+e+"px"},f,g):b.animate({translate:c+"px"},f,g)}}(mg),function(a,b){a.sidebarListener={handleEvent:function(b){switch(b.type){case"click":break;case"transitionend":case"webkitTransitionEnd":b.target.removeEventListener(b.type,a.sidebarListener,!1),a.sidebarCalculate(),setTimeout(function(){a.sidebarScroller.refresh()},0)}}},a.addEvent=function(a,b,c,d){var e=document.getElementById(a);d=d||!1;if("addEventListener"in e)try{e.addEventListener(b,c,d)}catch(f){if(typeof c=="object"&&c.handleEvent)e.addEventListener(b,function(a){c.handleEvent.call(c,a)},d);else throw f}else"attachEvent"in e&&(typeof c=="object"&&c.handleEvent?e.attachEvent("on"+b,function(){c.handleEvent.call(c)}):e.attachEvent("on"+b,c))}}(mg),function(a,b){a.touchEnabled===!0&&$("body").bind("touchmove",function(a){!!a.elementIsEnabled}),a.bindEvents=function(){a.touchEnabled===!0?(window.addEventListener("orientationchange",a.orientation,!1),a.slider.swipeRight(function(){a.prev()}),a.slider.swipeLeft(function(){a.next()})):(window.addEventListener("resize",a.center,!1),$(".mg-slider-page").bind("mousedown",a.mousedown),$(".mg-slider-page").bind("mousemove",a.mousemove),$(".mg-slider-page").bind("mouseup",a.mouseup))},a.orientation=function(b){var c=window.orientation,b=b||!0;switch(c){case 0:case 180:c="portrait",$(".landscape").hide(),$(".portrait").show();break;default:c="landscape",$(".portrait").hide(),$(".landscape").show()}b&&a.center()},a.sidebarEvents=function(){a.touchEnabled===!0?($(".sidebar-list-category").tap(a.sidebarToggle),$(".sidebar-list-item").tap(function(){a.gotoPage(parseInt($(this).attr("id").replace(/page-/,"")))})):($(".sidebar-list-category").bind("click",a.sidebarToggle),$(".sidebar-list-item").bind("click",function(){a.gotoPage(parseInt($(this).attr("id").replace(/page-/,"")))}))},a.sidebarToggle=function(b,c){c=c||$(this).attr("id").replace(/sidebar-category-/,"");if(a.sidebarCategoryActive===c)return;a.touchEnabled===!0?a.addEvent("sidebar-category-content-"+c,"webkitTransitionEnd",a.sidebarListener):a.addEvent("sidebar-category-content-"+c,"transitionend",a.sidebarListener),$("#sidebar-category-content-"+a.sidebarCategoryActive).removeClass("sidebar-list-category-active"),$("#sidebar-category-content-"+a.sidebarCategoryActive).css("height",0),$("#sidebar-category-content-"+c).addClass("sidebar-list-category-active"),$("#sidebar-category-content-"+c).css("height",a.sidebarHightList[c]),a.sidebarCategoryActive=c},a.sidebarGoTo=function(c){var d=a.getCategory(c);a.sidebarCategoryActive!==d&&a.sidebarToggle(b,d)},a.getCategory=function(b){var c=a.get("category");return c[b]},a.sidebarCalculate=function(){$(".sidebar-category-content").each(function(){a.sidebarHightList.push($(this).css("height"))})},a.mousedown=function(b){a.mouse={},a.mouse.startX=b.clientX,a.mouse.startY=b.clientY,a.mouse.X=0,a.mouse.Y=0,a.mouse.initiated=!0,a.moved=!1},a.mousemove=function(b){if(a.mouse.initiated===!1)return;a.moved=!0,a.mouse.X=b.clientX,a.mouse.Y=b.clientY},a.mouseup=function(b){var c=0,d=0,e=0,f=80;if(a.moved===!0){d=a.mouse.startX-a.mouse.X,e=a.mouse.startY-a.mouse.Y;if(d>=f||d*-1>=f)c=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2))}a.moved===!0&&c>=f&&(a.mouse.startX-a.mouse.X>0?a.next():a.prev()),a.mouse.startX=0,a.mouse.startY=0,a.mouse.X=0,a.mouse.Y=0,a.mouse.initiated=!1,a.moved=!1}}(mg),function(a,b){var c;a.loadOptions=function(b){c=b,a.loadJson(a.setOptions)},a.loadJson=function(b){$.getJSON(a.options.json,b,function(a){console.log(a)})},a.setOptions=function(b){var d;for(d in b)a.options[d]=b[d];c()},a.getWidth=function(b){var c;return a.widthList=a.widthList||{},typeof a.widthList[b[0]["id"]]!="undefined"?a.widthList[b[0].id]:(c=b.css("width"),c=parseInt(c.replace(/px/,"")),c)},a.resetWidth=function(){a.widthList={}},a.getMargin=function(b){var c;return a.marginList=a.marginList||{},typeof a.marginList[b[0]["id"]]!="undefined"?a.marginList[b[0].id]:(c=b.css("margin-left"),c=parseInt(c.replace(/px/,"")),c)},a.resetMargin=function(){a.marginList={}},a.ScrollFix=function(a){var b,c;if(!a)return;a.addEventListener("touchstart",function(d){b=d.touches[0].pageY,c=a.scrollTop,c<=0&&(a.scrollTop=1),c+a.offsetHeight>=a.scrollHeight&&(a.scrollTop=a.scrollHeight-a.offsetHeight-1)},!1)},a.showOverlay=function(){$("#mg-loader").fadeIn(200)},a.hideOverlay=function(){$("#mg-loader").fadeOut(1e3)},a.removeVideoPlayer=function(a){var b=_V_(a);b.techName=="html5"&&(b.tag.src="",b.tech.removeTriggers(),b.load()),b.tech.destroy(),b.destroy()},a.removeAudioPlayer=function(a){}}(mg),function(a,b){a.carouselInit=function(b){var c,d,e,f=0,g=0,h,i=0,j,k,l,m={initiated:!1},n,o,p,q,r;b=$(b),e=$(".mg-carousel-indicator",b),d=$("img",b),d.css("display","inline"),d.eq(0).one("load",function(){b.css("height",parseInt(d.css("height").replace(/px/,""))+20+"px")}).each(function(){this.complete&&$(this).trigger("load")}),b.css("width",d.css("width")),e.css("width",d.css("width")),$("li",b).each(function(a,b){$(b).css("left",a*100+"%")}),c=$(".mg-carousel-container",b),g=d.length-1,h=d.css("width"),h=parseInt(h.replace(/px/,"")),l=function(b){h=c.css("width"),h=parseInt(h.replace(/px/,"")),i=f*h*-1,a.animate(c,i,0,0,0)},j=function(b){f+1<=g&&(f++,i-=h,a.animate(c,i),setActive(f)),b.preventDefault(),b.stopPropagation()},k=function(b){f-1>=0&&(f--,i+=h,a.animate(c,i),setActive(f)),b.preventDefault(),b.stopPropagation()},setActive=function(a){var c=$(".mg-carousel-indicator label",b);c.each(function(b,c){b===a?$(c).addClass("active"):$(c).removeClass("active")})},n=function(a){m={},m.startX=a.clientX,m.startY=a.clientY,m.X=0,m.Y=0,m.initiated=!0,r=!1,a.preventDefault()},o=function(a){if(m.initiated===!1)return;r=!0,m.X=a.clientX,m.Y=a.clientY},p=function(a){var b=0,c=0,d=0,e=40;if(r===!0){c=m.startX-m.X,d=m.startY-m.Y;if(c>=e||c*-1>=e)b=Math.sqrt(Math.pow(Math.abs(c),2)+Math.pow(Math.abs(d),2))}r===!0&&b>=e&&(m.startX-m.X>0?j(a):k(a)),m.startX=0,m.startY=0,m.X=0,m.Y=0,m.initiated=!1,r=!1},q=function(a){m.startX=0,m.startY=0,m.X=0,m.Y=0,m.initiated=!1,r=!1},a.touchEnabled===!0?(c.swipeRight(k),c.swipeLeft(j)):(c.bind("mousedown",n),c.bind("mousemove",o),c.bind("mouseup",p),c.bind("mouseout",q),$("label",e).each(function(b,d){$(d).bind("click",function(){a.animate(c,b*h*-1),setActive(b),f=b,i=b*h*-1})}))},a.carouselDestroy=function(b){var c;b=$(b),c=$(".mg-carousel-container",b),a.touchEnabled===!0?(c.unbind("swipeRight"),c.unbind("swipeLeft")):(c.unbind("mousedown"),c.unbind("mousemove"),c.unbind("mouseup"))}}(mg),mg.init();